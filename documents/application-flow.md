# AI Processor Agent - Application Flow

This document provides a detailed description of the application flow in the AI Processor Agent system, explaining how users interact with structures through the four main tabs and how the backend processes the data.

## Overview

The AI Processor Agent is a node-based workflow application that enables users to:
1. Select pre-defined structures containing nodes and connections
2. Manipulate these structures by adding content through various tools
3. Process the content using AI to generate intelligent outputs
4. View and manage the outputs produced by the system

The application follows a sequential workflow across four main tabs, each with a specific purpose.

## Application Flow

### 1. Structures Tab

The Structures tab serves as the entry point for users to select a structure that defines the workflow.

**User Actions:**
- View available structures loaded from `structures.json`
- Select a structure for processing
- View details about structures (nodes, connections)

**Technical Implementation:**
- `setupStructuresTabHandlers()` in `structures-handlers.js` registers event handlers
- Structures are loaded via `api.loadJohtoData()`
- When a structure is selected, it's stored in `appState.currentStructure`
- The application automatically switches to the Inputs tab

**Data Flow:**
- Structures data is stored in `/data/structures.json`
- Each structure contains nodes and connections forming a directed graph
- Nodes can be of different types (start, process, finish) with various configurations

### 2. Inputs Tab

The Inputs tab allows users to view the selected structure in detail and interact with nodes.

**User Actions:**
- View the structure's nodes and connections
- Select a specific node to work with
- Use node tools (web search, RSS feed, file upload) to add input content

**Technical Implementation:**
- `setupInputsTabHandlers()` in `inputs-handlers.js` manages interactions
- Node selection is handled by `selectNode()`
- Node tools appear based on the node's configuration
- Inputs are sent to the backend via API calls:
  - `api.searchWeb()` for web searches
  - `api.processRSS()` for RSS feeds
  - `api.processFile()` for file uploads

**Node Configuration:**
- Each node can have different configurations determining available tools
- Settings like `use_rss_feed`, `use_file_input`, and `allow_automation`
- Some nodes may have predefined prompts and parameters

### 3. Process Tab

The Process tab is where AI processing occurs, transforming inputs according to the structure.

**User Actions:**
- Send custom prompts to the AI assistant
- Use automated processing features (Auto-Refine, Self-Reflection)
- View conversation with the AI in real-time

**Technical Implementation:**
- `setupProcessTabHandlers()` in `process-handlers.js` manages processing
- User prompts are sent via `api.processPrompt()`
- Automated processing uses:
  - `api.runAutoRefinement()` for refining inputs
  - `api.generateReflection()` for self-reflection
- AI responses appear in the conversation area

**AI Processing:**
- Backend uses `llm.py` to process prompts
- The LLM module connects to an external API (Dolphin LLM)
- AI responses follow the structure's workflow, with nodes processed according to connections
- Each node can influence how the AI processes its inputs

### 4. Outputs Tab

The Outputs tab displays the files generated by the AI processing.

**User Actions:**
- View outputs produced by the workflow
- Create new outputs manually
- Edit existing outputs

**Technical Implementation:**
- `setupOutputsTabHandlers()` in `outputs-handlers.js` manages output interactions
- Outputs are saved via `api.saveOutput()`
- Each output includes a file name and content

**Output Management:**
- Outputs are saved in the job structure
- They represent the final results of the workflow
- Can be reviewed and modified as needed

## Backend Processing

Behind the user interface, the application uses a structure interpreter to process workflows:

1. **Job Creation**: When a structure is selected, a job is created with steps corresponding to nodes
2. **Step Folders**: The system creates folders for each step in the workflow
3. **Connection Mapping**: Connections between nodes are mapped to data flow between steps
4. **LLM Processing**: The system uses `llm.py` to generate responses based on node configurations and inputs
5. **Output Generation**: The final outputs are stored and made available for viewing

The LLM (Language Learning Model) integration uses:
```python
def generate_llm_response(prompt, max_length=500, temperature=1.0, top_k=50, top_p=0.9, repetition_penalty=1.0):
    # Configures parameters for the AI request
    # Sends prompt to external Dolphin API
    # Processes and returns the AI response
```

## Conclusion

The AI Processor Agent provides a flexible system for creating AI-powered workflows. By separating the process into distinct tabs (Structures, Inputs, Process, Outputs), the application guides users through selecting structures, adding content, processing with AI, and managing outputs in a logical sequence.

This design enables complex workflow automation where structures define processing steps, and AI handles content generation according to node configurations and connections.